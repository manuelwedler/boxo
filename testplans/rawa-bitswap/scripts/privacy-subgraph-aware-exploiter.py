# %%
import os
import json
import matplotlib.pyplot as plt
import numpy as np

NAME = "privacy-subgraph-aware-exploiter"
FOLDER = "results/" + NAME

labels = [0.2, 0.3]
n2Precisions = {"0.2": [], "0.3": []}
n4Precisions = {"0.2": [], "0.3": []}
n0Precisions = {"0.2": [], "0.3": []}
n2Recalls = {"0.2": [], "0.3": []}
n4Recalls = {"0.2": [], "0.3": []}
n0Recalls = {"0.2": [], "0.3": []}

for subdir, _, files in os.walk(FOLDER):
    if "results.out" not in files:
        continue
    dataDirName = subdir.split("/")[-3]
    nStr = dataDirName.split("_")[0]
    pStr = dataDirName.split("_")[1]
    n = int(nStr[2:-1])
    p = pStr[2:-1]
    with open(subdir + "/results.out") as f:
        for l in f:
            datapoint = json.loads(l)
            if datapoint["name"] == "subgraph-aware-want-forward-exploiter-precision":
                if n == 0:
                    n0Precisions[p].append(float(datapoint["measures"]["value"]))
                if n == 2:
                    n2Precisions[p].append(float(datapoint["measures"]["value"]))
                if n == 4:
                    n4Precisions[p].append(float(datapoint["measures"]["value"]))
            if datapoint["name"] == "subgraph-aware-want-forward-exploiter-recall":
                if n == 0:
                    n0Recalls[p].append(float(datapoint["measures"]["value"]))
                if n == 2:
                    n2Recalls[p].append(float(datapoint["measures"]["value"]))
                if n == 4:
                    n4Recalls[p].append(float(datapoint["measures"]["value"]))


# %%
fig, ax = plt.subplots(figsize=[3.6, 4.8])
pos = np.arange(1, 3)

bpp01 = ax.boxplot(n2Precisions.values(), widths=0.2, patch_artist=True,
    showmeans=False, showfliers=True, sym="+",
    positions=pos-0.25,
    medianprops={"color": "white", "linewidth": 1.0},
    boxprops={"facecolor": "#ae4132", "edgecolor": "white",
                "linewidth": 0.5},
    whiskerprops={"color": "#ae4132", "linewidth": 1.5},
    capprops={"color": "#ae4132", "linewidth": 1.5})
bpp02 = ax.boxplot(n4Precisions.values(), widths=0.2, patch_artist=True,
    showmeans=False, showfliers=True, sym="+",
    positions=pos,
    medianprops={"color": "white", "linewidth": 1.0},
    boxprops={"facecolor": "#56517e", "edgecolor": "white",
                "linewidth": 0.5},
    whiskerprops={"color": "#56517e", "linewidth": 1.5},
    capprops={"color": "#56517e", "linewidth": 1.5})
bpp03 = ax.boxplot(n0Precisions.values(), widths=0.2, patch_artist=True,
    showmeans=False, showfliers=True, sym="+",
    positions=pos+0.25,
    medianprops={"color": "white", "linewidth": 1.0},
    boxprops={"facecolor": "#b46504", "edgecolor": "white",
                "linewidth": 0.5},
    whiskerprops={"color": "#b46504", "linewidth": 1.5},
    capprops={"color": "#b46504", "linewidth": 1.5})

plt.xticks([1,2], labels)
ax.set_ylabel("precision D of SAWFE")
ax.set_xlabel("proxy transition probability p")

# grid configuration
plt.yticks(np.arange(0.05,0.6,0.05), minor=True) 
plt.tick_params(which='minor', length=0)  
plt.grid(axis="y")
plt.grid(axis="y", which="minor")

ax.legend(
    [bpp01["boxes"][0], bpp02["boxes"][0], bpp03["boxes"][0]], 
    ["η=1", "η=2", "η=∆(G)"], 
    loc="lower left")

# plt.savefig("plots/" + NAME + "-precision.svg", format="svg")
plt.show()

# %%
fig, ax = plt.subplots(figsize=[3.6, 4.8])
pos = np.arange(1, 3)

bpp01 = ax.boxplot(n2Recalls.values(), widths=0.2, patch_artist=True,
    showmeans=False, showfliers=True, sym="+",
    positions=pos-0.25,
    medianprops={"color": "white", "linewidth": 1.0},
    boxprops={"facecolor": "#ae4132", "edgecolor": "white",
                "linewidth": 0.5},
    whiskerprops={"color": "#ae4132", "linewidth": 1.5},
    capprops={"color": "#ae4132", "linewidth": 1.5})
bpp02 = ax.boxplot(n4Recalls.values(), widths=0.2, patch_artist=True,
    showmeans=False, showfliers=True, sym="+",
    positions=pos,
    medianprops={"color": "white", "linewidth": 1.0},
    boxprops={"facecolor": "#56517e", "edgecolor": "white",
                "linewidth": 0.5},
    whiskerprops={"color": "#56517e", "linewidth": 1.5},
    capprops={"color": "#56517e", "linewidth": 1.5})
bpp03 = ax.boxplot(n0Recalls.values(), widths=0.2, patch_artist=True,
    showmeans=False, showfliers=True, sym="+",
    positions=pos+0.25,
    medianprops={"color": "white", "linewidth": 1.0},
    boxprops={"facecolor": "#b46504", "edgecolor": "white",
                "linewidth": 0.5},
    whiskerprops={"color": "#b46504", "linewidth": 1.5},
    capprops={"color": "#b46504", "linewidth": 1.5})

plt.xticks([1,2], labels)
ax.set_ylabel("recall R of SAWFE")
ax.set_xlabel("proxy transition probability p")

# grid configuration
plt.yticks(np.arange(0.2,0.95,0.05), minor=True)
plt.tick_params(which='minor', length=0)
plt.grid(axis="y")
plt.grid(axis="y", which="minor")

ax.legend(
    [bpp01["boxes"][0], bpp02["boxes"][0], bpp03["boxes"][0]], 
    ["η=1", "η=2", "η=∆(G)"], 
    loc="lower left")

# plt.savefig("plots/" + NAME + "-recall.svg", format="svg")
plt.show()

# %%

print("MEANS PRECISION SAWFE")
for k, v in n2Precisions.items():
    print(f"RaWa [η=1,p={k}]: {np.mean(v)}")
for k, v in n4Precisions.items():
    print(f"RaWa [η=2,p={k}]: {np.mean(v)}")
for k, v in n0Precisions.items():
    print(f"RaWa [η=∆(G),p={k}]: {np.mean(v)}")

print()

print("MEDIANS PRECISION SAWFE")
for k, v in n2Precisions.items():
    print(f"RaWa [η=1,p={k}]: {np.median(v)}")
for k, v in n4Precisions.items():
    print(f"RaWa [η=2,p={k}]: {np.median(v)}")
for k, v in n0Precisions.items():
    print(f"RaWa [η=∆(G),p={k}]: {np.median(v)}")

# %%

print("MEANS RECALL SAWFE")
for k, v in n2Recalls.items():
    print(f"RaWa [η=1,p={k}]: {np.mean(v)}")
for k, v in n4Recalls.items():
    print(f"RaWa [η=2,p={k}]: {np.mean(v)}")
for k, v in n0Recalls.items():
    print(f"RaWa [η=∆(G),p={k}]: {np.mean(v)}")

print()

print("MEDIANS RECALL SAWFE")
for k, v in n2Recalls.items():
    print(f"RaWa [η=1,p={k}]: {np.median(v)}")
for k, v in n4Recalls.items():
    print(f"RaWa [η=2,p={k}]: {np.median(v)}")
for k, v in n0Recalls.items():
    print(f"RaWa [η=∆(G),p={k}]: {np.median(v)}")

# %%

def iqr(v):
    q1 = np.quantile(v, 0.25)
    q3 = np.quantile(v, 0.75)
    return q3 - q1

print("Q1 & Q3 [IQR] RECALL SAWFE")
for k, v in n2Recalls.items():
    print(f"RaWa [η=1,p={k}]: {round(np.quantile(v, 0.25), 2)} - {round(np.quantile(v, 0.75), 2)} [{round(iqr(v), 2)}]")
for k, v in n4Recalls.items():
    print(f"RaWa [η=2,p={k}]: {round(np.quantile(v, 0.25), 2)} - {round(np.quantile(v, 0.75), 2)} [{round(iqr(v), 2)}]")
for k, v in n0Recalls.items():
    print(f"RaWa [η=∆(G),p={k}]: {round(np.quantile(v, 0.25), 2)} - {round(np.quantile(v, 0.75), 2)} [{round(iqr(v), 2)}]")

print()

print("Q1 & Q3 [IQR] PRECISION SAWFE")
for k, v in n2Precisions.items():
    print(f"RaWa [η=1,p={k}]: {round(np.quantile(v, 0.25), 2)} - {round(np.quantile(v, 0.75), 2)} [{round(iqr(v), 2)}]")
for k, v in n4Precisions.items():
    print(f"RaWa [η=2,p={k}]: {round(np.quantile(v, 0.25), 2)} - {round(np.quantile(v, 0.75), 2)} [{round(iqr(v), 2)}]")
for k, v in n0Precisions.items():
    print(f"RaWa [η=∆(G),p={k}]: {round(np.quantile(v, 0.25), 2)} - {round(np.quantile(v, 0.75), 2)} [{round(iqr(v), 2)}]")

# %%
